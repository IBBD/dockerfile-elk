#
# ElasticSearch Dockerfile with IK plugin for chinese
#
# https://github.com/ibbd/dockerfile-elk/elasticsearch
#
#

# Pull base image.
FROM elasticsearch:5.3.2

MAINTAINER reflying "278432993@qq.com"

# 安装插件
# ElasticSearch IK for chinese
# 注意检查版本：https://github.com/medcl/elasticsearch-analysis-ik
ENV ELASTICSEARCH_IK_MAJOR 5.3.2
ADD https://github.com/medcl/elasticsearch-analysis-ik/archive/v$ELASTICSEARCH_IK_MAJOR.tar.gz /tmp/elasticsearch-analysis-ik.tar.gz
RUN apt-get update && \
    apt-get install -y --no-install-recommends --force-yes maven openjdk-8-jdk && \
    rm -rf /var/lib/apt/lists/* && \
    tar -xvf /tmp/elasticsearch-analysis-ik.tar.gz -C /tmp && \
    cd /tmp/elasticsearch-analysis-ik-$ELASTICSEARCH_IK_MAJOR && \
    mvn package && \
    unzip target/releases/elasticsearch-analysis-ik-$ELASTICSEARCH_IK_MAJOR.zip -d /usr/share/elasticsearch/plugins/ik && \
    cd / && \
    rm -rf /tmp/elasticsearch-analysis-ik*

RUN echo "vm.max_map_count=262144" >> /etc/sysctl.conf

# 解决时区问题
ENV TZ "Asia/Shanghai"

# 终端设置
ENV TERM xterm

EXPOSE 9300
EXPOSE 9200
